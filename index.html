<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8">
    <title>igov 安心政府</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script type="text/javascript" src="js/service-data.js"></script>
  </head>
  <body></body>
  <section id="header">
    <div class="container">
      <div class="row">
        <div><img src="image/igov-logo.svg" class="brand"></div>
      </div>
      <div class="row">
        <div class="form-control search">
          <input id="search" type="text" class="form-input search-bar"><a target="_blank" id="searchButton" class="button">搜尋</a>
        </div>
      </div>
    </div>
  </section>
  <section id="service">
    <div class="container">
      <div class="list">
      </div>
    </div>
  </section>
  <section id="footer">
    <div class="container">
      <div class="col">
        <div class="col"><img src="image/igov-logo-white.svg" class="icon igov"></div>
        <div class="col slogan"><span>Suitable</span><span>Secure</span><span>Smart</span></div>
      </div>
      <div class="col">
        <div class="col"><img src="image/fb-icon.png" class="icon"></div>
        <div class="col"><a href="https://www.facebook.com/iGov.service/" target="_blank">安心政府i-Gov</a></div>
      </div>
      <div class="col">
        <div class="col"><span>E-mail:xxxs</span></div>
      </div>
    </div>
  </section>
  <script id="tmplItem" type="text/x-jquery-tmpl">
    <div class="col-3">
    <div class="list-item ${name}" data-list="${dataList}">
    	<div class="list-icon"></div><span class="label">${label}</span>
    </div>
    </div>
  </script>
  <script id="tmplFolder" type="text/x-jquery-tmpl">
    <div class="col-12">
    <div class="list-item ${name}">
    {{each links}}<span class="sub-item"><a href="${$value.href}" target="_blank">${$value.title}</a></span>{{/each}}
    </div>
    </div>
  </script>
  <script type="text/javascript">
    var data = [];
    $.each($boxes, function(i, val){
    	$name = $boxes[i].name;
    	//- for(var link in $Links[$name].links){
    		
    	//- };
    	$.each($Links[$name].links, function(index, value){
    		data.push({
    			label: value.title,
    			value: value.href,
    			category: $boxes[i].label,
    		});
    	});
    });
    //- console.log(data);
    $('#search').autocomplete({
    	minLength: 0,
    	source: data,
    	focus: function(event, ui) {
    		//- console.log(ui.item.eng)
    		$( "#search" ).val( ui.item.label );
    		return false;
    	},
    	select: function(event, ui) {
    		//- console.log(ui.item);
    		$("#search").val(ui.item.label);
    		$("#searchButton").attr('href', ui.item.value);
    		return false;
    	}
    }).autocomplete( "instance" )._renderItem = function(ul, item) {
    	$a = $("<a href='"+item.value+"' target='_blank'></a>")
    		.append( "<span class='category'>" + item.category + "</span>")
    		.append( "<span class='label'>" + item.label + "</span>" );
    	return $("<li>").append($a).appendTo(ul);
    };
  </script>
  <script type="text/javascript">
    $.each($boxes, function(i, value){
    	$boxes[i].dataList = JSON.stringify($Links[$boxes[i].name]);
    });
    $('#tmplItem').tmpl($boxes).appendTo( $('#service .list') );
    $('#service .list-item').click(function(){
    	$_this = $(this);
    	$('.list .list-item').removeClass('active');
    	$data = $_this.attr('data-list');
    	$data = $.parseJSON($data);
    	$n = $_this.parent('.col-3').prevAll('.col-3').length;
    	$a = $n+1;
    	//- console.log($n-$n%4+4);
    	if($n == $('.list').attr('data-open')) {
    		$('.list .col-12').slideUp(function(){$(this).remove()});
    		$('.list').removeAttr('anchor').removeAttr('data-open');
    		return;
    	}
    	
    	$cols = $('.list .col-3');
    	$_this.addClass('active');
    	$_this.parent('.col-3').nextAll('.col-3').each(function(){
    		//- console.log($($cols[$a-1]));
    		if($(this).offset().left <= $($cols[$a-1]).offset().left ){
    			return false;
    		}
    		$a++;
    		//- }
    	});
    	//- console.log($a);
    	$a--;
    	if($a == $('.list').attr('anchor')) {
    		$('.list .col-12').remove();
    		$('#tmplFolder').tmpl($data).insertAfter( $($cols[$a]) );
    	} else {
    		$('.list .col-12').slideUp(function(){$(this).remove()});
    		$('#tmplFolder').tmpl($data).insertAfter( $($cols[$a]) ).hide().slideDown();
    	}
    	$('.list').attr({'anchor': $a, 'data-open': $n});
    	//- console.log(	$('.list').children(':eq('+$n+')') );
    });
    //- $('.payment').clone().appendTo('.list');
  </script>
</html>